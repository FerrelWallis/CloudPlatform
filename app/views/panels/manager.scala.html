@()(implicit session: Session)
@home.main("ManagerPanel") {
    @*<linkrel="stylesheet"type="text/css"href="@routes.Assets.versioned("css/test/mysoft.css")"media="screen"/>*@
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("mycss/index.css")" media="screen"/>
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("wangeditor/wangEditor.css")" media="screen"/>
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap.min.css")">
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap-table.min.css")">
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-datepicker-1.9.0/css/bootstrap-datepicker.css")">

    <script type = "text/javascript" src="@routes.Assets.versioned("bootstrap/js/bootstrap.js")"></script>
    <script src = "@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap-table.js")" type = "text/javascript" ></script>
    <script src = "@routes.Assets.versioned("bootstrap-table-master/dist/locale/bootstrap-table-zh-CN.min.js")" type = "text/javascript"></script>
    <script src = "@routes.Assets.versioned("bootstrap-datepicker-1.9.0/js/bootstrap-datepicker.js")" type = "text/javascript" ></script>
    <script src = "@routes.Assets.versioned("bootstrap-datepicker-1.9.0/locales/bootstrap-datepicker.zh-CN.min.js")" type = "text/javascript"></script>
    <script type = "text/javascript" src = "@routes.Assets.versioned("wangeditor/wangEditor.js")" ></script>
    <script type = "text/javascript" src = "@routes.Assets.versioned("myjs/jquery-ui-tabs.js")"></script>
    <script src = "@routes.Assets.versioned("layer-v3.0/layer/layer.js")" type = "text/javascript" ></script>

    <script src = "@routes.Assets.versioned("Highcharts-8.2.0/code/highcharts.js")" type = "text/javascript"></script>
    <script src = "@routes.Assets.versioned("Highcharts-8.2.0/code/modules/exporting.js")" type = "text/javascript"></script>
    <script src = "@routes.Assets.versioned("Highcharts-8.2.0/code/modules/data.js")" type = "text/javascript"></script>
    <script src = "@routes.Assets.versioned("Highcharts-8.2.0/code/modules/drilldown.js")" type = "text/javascript"></script>

    <style>
            .btn-primary:hover, .btn-primary:focus, .btn-primary.focus, .btn-primary:active, .btn-primary.active, .open > .dropdown-toggle.btn-primary {
                color: #fff;
                background-color: #0d2648;
                border-color: #0d2648;
            }

            .btn-primary {
                color: #fff;
                background-color: #0d2648;
                border-color: #0d2648;
            }

            .ui-tabs .ui-tabs-nav li a {
                float: left;
                padding: 8px 4.5em 9px 4.5em;
                text-decoration: none;
                outline: none;
                color: black;
                text-shadow: none;
            }

            .manager_ul li {
                width: 100%;
            }

            .manager {
                padding-top: 20px;
            }

            .manager_panel {
                padding: 1em 0em 1em 1em;
                float: left;
            }

            .glyphicon-calendar:before {
                content: "\e109"
            }

            input[type="text"], textarea {
                background: #fff;
                background: rgba(255, 255, 255, .4);
                border-top: 1px solid #dfe0de;
                border-left: 1px solid #dfe0de;
                border-right: 1px solid #dfe0de;
                border-bottom: 1px solid #dfe0de;
                padding: 7px 9px;
                border-radius: 3px;
                border-top-right-radius: 3px;
                border-bottom-right-radius: 3px;
                color: #888;
                box-shadow: inset 0 1px 1px rgba(0, 0, 0, .1);
            }

            .datepicker table tr th, .datepicker table tr td {
                border: unset !important;
            }

            .datepicker table tr td .active, .datepicker table tr td .active:hover, .datepicker table tr td .active .disabled, .datepicker table tr td .active .disabled:hover {
                background-color: #006dcc;
                background-image: -moz-linear-gradient(to bottom, #08c, #08c);
                background-image: -ms-linear-gradient(to bottom, #08c, #08c);
                background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#08c), to(#08c));
                background-image: -webkit-linear-gradient(to bottom, #08c, #08c);
                background-image: -o-linear-gradient(to bottom, #08c, #08c);
                background-image: linear-gradient(to bottom, #08c, #08c);
                background-repeat: repeat-x;
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#08c', endColorstr='#0044cc', GradientType=0);
                border-color: #0044cc #0044cc #002a80;
                border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
                border-top-color: rgba(0, 0, 0, 0.1);
                filter: progid:DXImageTransform.Microsoft.gradient(enabled=false);
                color: #fff;
                text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
            }

            .submit {
                padding: 10px 30px 10px 30px;
                background: #036;
                float: right;
                margin-top: 20px;
                margin-right: 10px;
            }

            .submit:hover {
                padding: 10px 30px 10px 30px;
                background: #0d2648 !important;
                float: right;
                margin-top: 20px;
                margin-right: 10px;
            }

            #editor table tr th, #editor table tr td {
                border: 1px solid rgba(120, 130, 140, 0.82) !important;
            }

            .form-group label {
                margin-top: 8px;
                margin-bottom: 0px;
            }

            h1, h2, h3, h4, h5, h6 {
                font-family: "HelveticaNeue", Helvetica, 'MicrosoftYahei', 'HiraginoSansGB', 'WenQuanYiMicroHei', Tahoma, Arial, sans-serif;
                font-weight: 700;
                line-height: 1.1;
                color: inherit;
            }

            h3 {
                font-size: 16px;
            }

            .col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12, .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12, .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12, .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
                position: relative;
                min-height: 1px;
                padding-right: 0px;
                padding-left: 0px;
            }

            .control-icon {
                padding-left: 32px;
                background-position: center;
            }

            #auth a:active {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
                background: transparent;
            }
            .sweet-alert .text-muted {
                color: gray;
            }
            .sweet-alert .lead {
                font: 13px/1.5 'PTSansRegular', Arial, Helvetica, sans-serif;
                font-size: 15.5px;
                margin-bottom: 20px;
                line-height: 1.4;
            }
            .sweet-alert h1, h2, h3, h4, h5, h6 {
                font-family: "Helvetica Neue", Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', Tahoma, Arial, sans-serif;
                font-weight: 700;
                line-height: 1.1;
                color: inherit;
                font-size: 20px;
                margin-top: 20px;
                margin-bottom: 10px;
                text-shadow: 0 1px 0 #fff;
            }
    </style>

    <div class="container main padding" style="background: white; min-height: 810px; width: 96.5%;">
        <div class="mws-panel grid_8 manager">
            <div class="mws-tabs" style="height: 100%">
                <div class="col-md-2" style="height: 100%">
                    <div style="width: 100%; float: left">
                        <ul class="manager_ul">
                            <li><a href="#notice" style="width: 100%; text-align: center; padding: 8px 0px;">发布公告</a></li>
                            <li><a href="#auth" style="width: 100%; text-align: center; padding: 8px 0px;">用户列表</a></li>
                            <li><a href="#feed" style="width: 100%; text-align: center; padding: 8px 0px;">反馈列表<span class="badge feed_badge" style="margin-left: 10px;"></span></a></li>
                            <li><a href="#runningnote" style="width: 100%; text-align: center; padding: 8px 0px;">滚动通知栏设置</a></li>
                            <li><a href="#softfreq" style="width: 100%; text-align: center; padding: 8px 0px;">模块使用频率</a></li>
                            <li><a href="#dutyfile" style="width: 100%; text-align: center; padding: 8px 0px;">获取任务文件</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-9" style="height: 100%; width: 83%;">
                    <div id="notice" class="manager_panel" style="padding-top: 0px; width: 96%; padding-right: 0px;">
                        <form id="subNotice" method="GET" enctype="multipart/form-data" class="form-inline" style="box-sizing: border-box !important;  margin-top: 10px">
                            <h3 style="margin-top: 0">发布公告</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div>
                                <div style="width: 50%; display: inline-block">
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告标题：</label>
                                        </div>
                                        <div class="form-group">
                                            <input id="title" type="text" class="form-control" name="title" placeholder="公告标题" style="width: 260px;">
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告发布时间：</label>
                                        </div>
                                        <div class="form-group">
                                            <div class='input-group date' id='datepicker1'>
                                                <input id="pubtime" name="pubtime" type='text' class="datepicker form-control" placeholder="请选择日期" style="border-radius: 3px;
                                                    width: 235px;"/>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告失效时间：</label>
                                        </div>
                                        <div class="form-group">
                                            <div class='input-group date' id='datepicker2'>
                                                <input id="failtime" name="failtime" type='text' class="datepicker form-control" placeholder="请选择日期" style="border-radius: 3px;
                                                    width: 235px;"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width: 45%;
                                    display: inline-block">
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告宽度：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="width" type="text" class="form-control" name="width" placeholder="" value="600" style="width: 100%;">
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告版面距离顶部：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="top" name="top" type='text' class="form-control" placeholder="" value="12" style="border-radius: 3px; width: 100%;"/>
                                        </div>
                                        <div class="form-group"><label>&nbsp;&nbsp;%</label>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告版面距离左部：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="left" name="left" type='text' class="form-control" placeholder="" value="50" style="border-radius: 3px; width: 100%;"/>
                                        </div>
                                        <div class="form-group"><label>&nbsp;&nbsp;%</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <br>
                            <div>
                                <label>公告内容：</label>
                                <div id="editor" style="width: 100%;">
                                </div>
                                <textarea id="txdata" name="txdata" style="display: none;"></textarea>
                            </div>
                            <label>发布公告机制：公告在设定的发布时间开始生效，日期未到用户页面不会弹出。失效时间，失效日期已过，即使用户未读过也不会自动弹出该公告。</label>
                            <br>
                            <br>
                            <input type="button" value="预&nbsp;&nbsp;览" name="submit" class="btn btn-primary submit" onclick="preview()">
                            <input type="button" value="发&nbsp;&nbsp;布" name="submit" class="btn btn-primary submit" onclick="submitNotice()">
                        </form>
                    </div>
                    <div id="auth" class="manager_panel" style="width: 96%; padding-right: 0px;">
                        <form>
                            <h3 style="margin-top: 0">用户列表</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div class="container" style="width: 98%; margin: unset; max-width: unset; background: white">
                                    <!--data-toolbar：设置装按钮的容器为id为toolbar的。-->
                                <div id="toolbar">&nbsp;搜索：</div>
                                <table class="display table table-bordered" style="width: 99.9%" id="table" data-pagination="true" data-search="true"
                                data-toolbar="#toolbar" data-page-list="[10,25,50,100,all]" data-search-align="left" data-multiple-search="true">
                                </table>
                            </div>
                            <div style="margin: 20px 0 0px 20px; float: left;">
                                <label style="color: #979797;">注意：权限修改完，被修改权限的用户需要重新登陆才能生效</label>
                            </div>
                        </form>
                    </div>
                    <div id="feed" class="manager_panel" style="width: 96%; padding-right: 0px;">
                        <form>
                            <h3 style="margin-top: 0">反馈列表</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div class="container" style="width: 98%; margin: unset; max-width: unset; background: white">
                                    <!--data-toolbar：设置装按钮的容器为id为toolbar的。-->
                                <div id="toolbar2">&nbsp;搜索：</div>
                                <div id="action2" >
                                    <input type="button" value="刷新列表" class="btn btn-primary btn-dark" onclick="refresh()" style="float: right;margin-top: 10px;margin-right: 10px;">
                                </div>
                                <table class="display table table-bordered" style="width: 99.9%" id="table2" data-pagination="true" data-search="true"
                                data-toolbar="#toolbar2" data-page-list="[10,25,50,100,all]" data-search-align="left" data-multiple-search="true">
                                </table>
                            </div>
                        </form>
                    </div>
                    <div id="runningnote" class="manager_panel" style="padding-top: 0px; width: 96%; padding-right: 0px;">
                        <form id="subRunning" method="GET" enctype="multipart/form-data" class="form-inline" style="box-sizing: border-box !important;  margin-top: 10px">
                            <h3 style="margin-top: 0">滚动通知栏设置</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div style="padding-left: 25px">
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知1：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote1" name="runnote1" class="form-control kindeditorSimple" style="width: 100%;height:80px;" ></textarea>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知2：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote2" name="runnote2" class="form-control kindeditorSimple" style="width: 100%;height:80px;"></textarea>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知3：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote3" name="runnote3" class="form-control kindeditorSimple" style="width: 100%;height:80px;"></textarea>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知4：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote4" name="runnote4" class="form-control kindeditorSimple" style="width: 100%;height:80px;"></textarea>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知5：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote5" name="runnote5" class="form-control kindeditorSimple" style="width: 100%;height:80px;"></textarea>
                                    </div>
                                </div>
                                <br>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>通知6：</label>
                                    </div>
                                    <div class="form-group" style="width: 90%">
                                        <textarea id="runnote6" name="runnote6" class="form-control kindeditorSimple" style="width: 100%;height:80px;"></textarea>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <br>
                            <input type="button" value="确认更新" name="submit" class="btn btn-primary submit" onclick="updateRun()">
                        </form>
                    </div>
                    <div id="softfreq" class="manager_panel" style="padding-top: 0px; width: 96%; padding-right: 0px;">
                        <form>
                            <h3 style="margin-top: 0">模块使用频率</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div id="container" style="min-width:400px; height:400px">
                            </div>
                        </form>
                    </div>
                    <div id="dutyfile" class="manager_panel" style="padding-top: 0px; width: 96%; padding-right: 0px;">
                        <form>
                            <h3 style="margin-top: 0">下载任务文件</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div class="container" style="width: 98%; margin: unset; max-width: unset; background: white">
                                    <!--data-toolbar：设置装按钮的容器为id为toolbar的。-->
                                <div id="toolbar3">&nbsp;搜索：</div>
                                <div id="action3" >
                                    <input type="button" value="列表刷新" class="btn btn-primary btn-dark" onclick="refresh2()" style="float: right;margin-top: 10px;margin-right: 10px;">
                                </div>
                                <table class="display table table-bordered" style="width: 99.9%" id="table3" data-pagination="true" data-search="true"
                                data-toolbar="#toolbar3" data-page-list="[10,25,50,100,all]" data-search-align="left" data-multiple-search="true">
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">新增</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="txt_departmentname">部门名称</label>
                        <input type="text" name="txt_departmentname" class="form-control" id="txt_departmentname" placeholder="部门名称">
                    </div>
                    <div class="form-group">
                        <label for="txt_parentdepartment">上级部门</label>
                        <input type="text" name="txt_parentdepartment" class="form-control" id="txt_parentdepartment" placeholder="上级部门">
                    </div>
                    <div class="form-group">
                        <label for="txt_departmentlevel">部门级别</label>
                        <input type="text" name="txt_departmentlevel" class="form-control" id="txt_departmentlevel" placeholder="部门级别">
                    </div>
                    <div class="form-group">
                        <label for="txt_statu">描述</label>
                        <input type="text" name="txt_statu" class="form-control" id="txt_statu" placeholder="状态">
                    </div>
                    <div class="form-group">
                        <label for="txt_statu">描述</label>
                        <input type="text" name="txt_statu" class="form-control" id="txt_statu" placeholder="状态">
                    </div>
                    <div class="form-group">
                        <label for="txt_statu">描述</label>
                        <input type="text" name="txt_statu" class="form-control" id="txt_statu" placeholder="状态">
                    </div>
                    <div class="form-group">
                        <label for="txt_statu">描述</label>
                        <input type="text" name="txt_statu" class="form-control" id="txt_statu" placeholder="状态">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>
                </div>
            </div>
        </div>
    </div>


    <script>

            $(document).ready(function () {
                formValidation();

                $('#pubtime').datepicker({
                    todayBtn: "linked",
                    language: "zh-CN",
                    orientation: "bottom auto"
                }).on("changeDate", function (e) {
                    $("#subNotice").formValidation("revalidateField", "pubtime");
                    $("#subNotice").formValidation("revalidateField", "failtime");
                });
                $('#failtime').datepicker({
                    todayBtn: "linked",
                    language: "zh-CN",
                    orientation: "bottom auto"
                }).on("changeDate", function (e) {
                    $("#subNotice").formValidation("revalidateField", "failtime");
                    $("#subNotice").formValidation("revalidateField", "pubtime");
                });
                loading();
                loading2();
                loadRunning();
                loadFreq();
                loading3();
            });

            function pop() {
                console.log(111);
                $("#myModal").modal();
            }

            function loadFreq() {
                $.ajax({
                    url: "/CloudPlatform/Utils/getSoftFreq",
                    type: "post",
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        var chart = Highcharts.chart('container',{
                            chart: {
                                type: 'pie'
                            },
                            title: {
                                text: '模块使用频率'
                            },
                            subtitle: {
                                text: '单击模块分类，查看所属所有模块的使用频率占比'
                            },
                            plotOptions: {
                                series: {
                                    dataLabels: {
                                        enabled: true,
                                        format: '{point.name}: {point.y:.1f}%'
                                    }
                                }
                            },
                            tooltip: {
                                headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                                pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
                            },
                            series: [{
                                name: '总分类',
                                colorByPoint: true,
                                data: data.classpart
                            }],
                            drilldown: {
                                series: data.softpart
                            }
                        });
                    }
                });
            }

            function loadRunning() {
                $.ajax({
                    url: "/CloudPlatform/Utils/getAllRunning",
                    type: "post",
                    success: function (data) {
                        $.each(data.rows,function (i,v) {
                            var i=v[0];
                            var content=v[1];
                            $("#runnote"+i).val(content);
                        });
                    }
                });
            }

            function loading() {
                $('#table').bootstrapTable({
                    method: 'post',
                    url: "/CloudPlatform/User/getAllUsers",
                    sidePagination: "server",
                    pageNumber: 1,
                    pagination: true,
                    pageList: [10, 25, 50, 100],
                    contentType: "application/x-www-form-urlencoded",
                    clickToSelect: true,//点击行选中
                    columns: [{
                        title: '用户id',
                        field: 'id',
                        sortable: 'true'
                    }, {
                        title: '用户名',
                        field: 'name',
                        sortable: 'true'
                    }, {
                        title: '手机号',
                        field: 'phone',
                        sortable: 'true'
                    }, {
                        title: '邮箱',
                        field: 'email',
                        sortable: 'true'
                    }, {
                        title: '公司/机构/学校',
                        field: 'company',
                        sortable: 'true'
                    }, {
                        title: 'ip地址',
                        field: 'ip',
                        sortable: 'true'
                    }, {
                        title: '权限',
                        field: 'authority',
                    }]
                });
            }

            function loading2() {
                $('#table2').bootstrapTable({
                    method: 'post',
                    url: "/CloudPlatform/Utils/getAllFeeds",
                    sidePagination: "server",
                    pageNumber: 1,
                    pagination: true,
                    pageList: [10, 25, 50, 100],
                    contentType: "application/x-www-form-urlencoded",
                    clickToSelect: true,//点击行选中
                    columns: [{
                        title: '提交日期',
                        field: 'subtime',
                    }, {
                        title: '标题',
                        field: 'title',
                    }, {
                        title: '任务编号',
                        field: 'taskname',
                    },{
                        title: '用户名',
                        field: 'name',
                    },{
                        title: '手机号',
                        field: 'phone',
                    }, {
                        title: '浏览状态',
                        field: 'process',
                    }, {
                        title: '操作',
                        field: 'control',
                        width: '120px',
                    }],
                    onClickCell: function (field, value, row, $element) {
                        if(field==="control") {
                            var index=$element.parent().data('index');
                            row.process="<p style='color: cadetblue; margin: 0px;'>已读</p>";
                            $('#table2').bootstrapTable('updateRow', {
                                index: index,
                                row: row
                            });
                        }
                    }
                });
            }

            function refresh() {
                $('#table2').bootstrapTable('destroy');
                loading2();
            }

            function loading3() {
                $('#table3').bootstrapTable({
                    method: 'post',
                    url: "/CloudPlatform/MyTasks/getDuties",
                    sidePagination: "server",
                    pageNumber: 1,
                    pagination: true,
                    pageList: [10, 25, 50, 100],
                    contentType: "application/x-www-form-urlencoded",
                    clickToSelect: true,//点击行选中
                    columns: [{
                        title: '提交日期',
                        field: 'subtime',
                    }, {
                        title: '任务编号',
                        field: 'taskname',
                    }, {
                        title: '功能模块',
                        field: 'sname',
                    }, {
                        title: '用户名',
                        field: 'username',
                    }, {
                        title: '任务状态',
                        field: 'status',
                    }, {
                        title: '操作',
                        field: 'control',
                    }]
                });
            }

            function refresh2() {
                $('#table3').bootstrapTable('destroy');
                loading3();
            }

            function showlog(taskname,uid) {
                $.ajax({
                    url: "/CloudPlatform/MyTasks/showlogByUid?taskname=" + taskname + "&uid=" + uid,
                    type: "post",
                    success: function (data) {
                        if(data.canmanage==0) {
                            swal({
                                title: "运行日志为空",
                                text: "运行日志为空！",
                                type: "warning",
                                confirmButtonText: "确认"
                            });
                        }else {
                            $("#logContent").text(data.content);
                            $("#liLog").click();
                        }
                    }
                });
            }

            function downduty(taskname,uid) {
                window.location.href = "/CloudPlatform/SoftTool/creatDownDuty?taskname="+taskname+"&uid="+uid+"&num="+Math.random();
            }

            var E = window.wangEditor;
            var editor = new E('#editor');
            //自定义菜单配置
            editor.customConfig.menus = [
                'head',//标题
                'bold',//粗体
                'fontName',//字体
                'italic',//斜体
                'underline',//下划线
                'strikeThrough',//删除线
                'foreColor',//文字颜色
                'backColor',//背景颜色
                'link',//插入链接
                'list',//列表
                'justify',//对齐方式
                'quote',//引用
                'emoticon',//表情
                'image',//插入图片
                'table',//表格
                'code',//插入代码
                'undo',//撤销
                'redo'//重复
            ];
            editor.customConfig.colors = [
                '#ffffff', '#000000', '#330000',
                '#cccc99', '#cccc00', '#cc9900', '#996600', '#660000',
                '#ffff99', '#ffcc00', '#ff9900', '#ff0000', '#ff000f',
                '#ffccff', '#ff99cc', '#ff00cc', '#cc0099',
                '#ccccff', '#cc99ff', '#996699', '#cc00ff', '#660099',
                '#ccffff', '#99ccff', '#3399ff', '#6600ff', '#330099',
                '#ccff00', '#ccff99', '#99cc99', '#339999', '#339900'
            ];
            editor.customConfig.uploadImgShowBase64 = true;
            editor.create();

            //tab
            $(".mws-tabs").tabs();

            function changeAuth(uid, autho) {
                if (confirm("确认修改权限吗？")) {
                    $.ajax({
                        url: "/CloudPlatform/User/updateAutho?uid=" + uid + "&authority=" + autho,
                        type: "post",
                        success: function (data) {
                            if (data.valid === "false") {
                                swal({
                                    title: "错误",
                                    text: "权限修改失败！" + data.message,
                                    type: "error",
                                    confirmButtonText: "确认"
                                });
                            } else {
                                $('#table').bootstrapTable('destroy');
                                loading();
                                swal({
                                    title: "修改成功",
                                    text: "权限修改成功！",
                                    type: "success",
                                    confirmButtonText: "确认"
                                });

                            }
                        }
                    });
                }
            }

            function submitNotice() {
                var form = $("#subNotice");
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    if (editor.txt.text() === "") {
                        swal({
                            title: "公告内容不能为空",
                            text: "公告内容不能为空!",
                            type: "warning",
                            confirmButtonText: "确认"
                        });
                    } else {
                        if (confirm("是否确认发布？")) {
                            $("#txdata").val(editor.txt.html());
                            var element = "<div id='content'><span id='info'>公告发布中...</span>&nbsp;<img class='runningImage' src='/assets/images/loader-twitter.gif' style='width:30px;height:20px;float:right;padding-right:11px;padding-top:2px;'></div>";
                            var index = layer.alert(element, {
                                skin: 'layui-layer-lan',
                                closeBtn: 0,
                                title: "提醒",
                                btn: []
                            });
                            setTimeout(function () {
                                layer.close(index);
                                var form1 = new FormData($("#subNotice")[0]);
                                $.ajax({
                                    url: "/CloudPlatform/Utils/insertNote",
                                    type: "post",
                                    processData: false,
                                    contentType: false,
                                    data: form1,
                                    success: function (data) {
                                        swal({
                                            title: "发布成功",
                                            text: "发布成功！",
                                            type: "success",
                                            confirmButtonText: "确认"
                                        },function (isConfirm) {
                                            window.location.href = "/CloudPlatform/managerPanel";
                                        });
                                    }
                                });
                            }, 2000);
                        }
                    }
                }
            }

            function preview() {
                $("#noteHead").text($("#title").val());
                $("#notePubtime").text($("#pubtime").val());
                $("#noteContent").html("");
                $("#noteContent").append(editor.txt.html());
                $("#latestNotice").css("width", $("#width").val());
                $("#latestNotice").css("top", $("#top").val() + "%");
                $("#latestNotice").css("left", $("#left").val() + "%");
                $("#liNotice").click();
            }

            function updateRun() {
                var form = $("#subRunning");
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    if (confirm("是否确认更新？")) {
                        var element = "<div id='content'><span id='info'>更新中...</span>&nbsp;<img class='runningImage' src='/assets/images/loader-twitter.gif' style='width:30px;height:20px;float:right;padding-right:11px;padding-top:2px;'></div>";
                        var index = layer.alert(element, {
                            skin: 'layui-layer-lan',
                            closeBtn: 0,
                            title: "提醒",
                            btn: []
                        });
                        setTimeout(function () {
                            layer.close(index);
                            var form1 = new FormData($("#subRunning")[0]);
                            $.ajax({
                                url: "/CloudPlatform/Utils/updateRunning",
                                type: "post",
                                processData: false,
                                contentType: false,
                                data: form1,
                                success: function (data) {
                                    swal({
                                        title: "更新成功",
                                        text: "更新成功！",
                                        type: "success",
                                        confirmButtonText: "确认"
                                    });
                                }
                            });
                        }, 2000);
                    }
                }
            }

            function formValidation() {
                $('#subNotice').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphiconglyphicon-ok',
                        invalid: 'glyphiconglyphicon-remove',
                        validating: 'glyphiconglyphicon-refresh'
                    },
                    fields: {
                        title: {
                            validators: {
                                notEmpty: {
                                    message: '公告标题不能为空!'
                                }
                            }
                        },
                        pubtime: {
                            validators: {
                                notEmpty: {
                                    message: '发布时间不能为空!'
                                },
                                callback: {
                                    message: '发布时间不得小于今天!',
                                    callback: function (value, validator, $field) {
                                        var datetime = new Date();
                                        var year = datetime.getFullYear();
                                        var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
                                        var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
                                        var now = year + "-" + month + "-" + date;
                                        return ($("#pubtime").val() >= now);
                                    }
                                }
                            }
                        },
                        failtime: {
                            validators: {
                                notEmpty: {
                                    message: '失效时间不能为空!'
                                },
                                callback: {
                                    message: '失效时间时间不得小于发布时间!',
                                    callback: function (value, validator, $field) {
                                        return ($("#failtime").val() >= $("#pubtime").val());
                                    }
                                }
                            }
                        },
                        width: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        top: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        left: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        }
                    }
                });
                $('#subRunning').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphiconglyphicon-ok',
                        invalid: 'glyphiconglyphicon-remove',
                        validating: 'glyphiconglyphicon-refresh'
                    },
                    fields: {
                        runnote1: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        runnote2: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                                // ,
                                // stringLength: {
                                //     max: 75,
                                //     message: '不得超过75个字符！'
                                // }
                            }
                        },
                        runnote3: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        runnote4: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        runnote5: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        runnote6: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        }
                    }
                });
            }



    </script>

}