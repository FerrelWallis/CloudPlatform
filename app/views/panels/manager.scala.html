@()(implicit session: Session)
@home.main("ManagerPanel") {
    @*<linkrel="stylesheet"type="text/css"href="@routes.Assets.versioned("css/test/mysoft.css")"media="screen"/>*@
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("mycss/index.css")" media="screen"/>
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("wangeditor/wangEditor.css")" media="screen"/>
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap.min.css")">
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap-table.min.css")">
    <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("bootstrap-datepicker-1.9.0/css/bootstrap-datepicker.css")">

    <script type="text/javascript" src="@routes.Assets.versioned("bootstrap/js/bootstrap.js")"></script>
    <script src = "@routes.Assets.versioned("bootstrap-table-master/dist/bootstrap-table.js")" type = "text/javascript" ></script>
    <script src="@routes.Assets.versioned("bootstrap-table-master/dist/locale/bootstrap-table-zh-CN.min.js")" type="text/javascript"></script>
    <script src = "@routes.Assets.versioned("bootstrap-datepicker-1.9.0/js/bootstrap-datepicker.js")" type = "text/javascript" ></script>
    <script src="@routes.Assets.versioned("bootstrap-datepicker-1.9.0/locales/bootstrap-datepicker.zh-CN.min.js")" type="text/javascript"></script>
    <script type = "text/javascript" src = "@routes.Assets.versioned("wangeditor/wangEditor.js")" ></script>
    <script type="text/javascript" src="@routes.Assets.versioned("myjs/jquery-ui-tabs.js")"></script>
    <script src = "@routes.Assets.versioned("layer-v3.0/layer/layer.js")" type = "text/javascript" ></script>

    <style>
            .btn-primary:hover, .btn-primary:focus, .btn-primary.focus, .btn-primary:active, .btn-primary.active, .open > .dropdown-toggle.btn-primary {
                color: #fff;
                background-color: #0d2648;
                border-color: #0d2648;
            }

            .btn-primary {
                color: #fff;
                background-color: #0d2648;
                border-color: #0d2648;
            }

            .ui-tabs .ui-tabs-nav li a {
                float: left;
                padding: 8px 3.5em 9px 3.5em;
                text-decoration: none;
                outline: none;
                color: black;
                text-shadow: none;
            }

            .manager_ul li {
                width: 100%;
            }

            .manager {
                padding-top: 20px;
            }

            .manager_panel {
                padding: 1em 0em 1em 1em;
                float: left;
            }

            .glyphicon-calendar:before {
                content: "\e109"
            }

            input[type="text"], textarea {
                background: #fff;
                background: rgba(255, 255, 255, .4);
                border-top: 1px solid #dfe0de;
                border-left: 1px solid #dfe0de;
                border-right: 1px solid #dfe0de;
                border-bottom: 1px solid #dfe0de;
                padding: 7px 9px;
                border-radius: 3px;
                border-top-right-radius: 3px;
                border-bottom-right-radius: 3px;
                color: #888;
                box-shadow: inset 0 1px 1px rgba(0, 0, 0, .1);
            }

            .datepicker table tr th, .datepicker table tr td {
                border: unset !important;
            }

            .datepicker table tr td .active, .datepicker table tr td .active:hover, .datepicker table tr td .active .disabled, .datepicker table tr td .active .disabled:hover {
                background-color: #006dcc;
                background-image: -moz-linear-gradient(to bottom, #08c, #08c);
                background-image: -ms-linear-gradient(to bottom, #08c, #08c);
                background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#08c), to(#08c));
                background-image: -webkit-linear-gradient(to bottom, #08c, #08c);
                background-image: -o-linear-gradient(to bottom, #08c, #08c);
                background-image: linear-gradient(to bottom, #08c, #08c);
                background-repeat: repeat-x;
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#08c', endColorstr='#0044cc', GradientType=0);
                border-color: #0044cc #0044cc #002a80;
                border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
                border-top-color: rgba(0, 0, 0, 0.1);
                filter: progid:DXImageTransform.Microsoft.gradient(enabled=false);
                color: #fff;
                text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
            }

            .submit {
                padding: 10px 30px 10px 30px;
                background: #036;
                float: right;
                margin-top: 20px;
                margin-right: 10px;
            }

            .submit:hover {
                padding: 10px 30px 10px 30px;
                background: #0d2648 !important;
                float: right;
                margin-top: 20px;
                margin-right: 10px;
            }

            #editor table tr th, #editor table tr td {
                border: 1px solid rgba(120, 130, 140, 0.82) !important;
            }

            .form-group label {
                margin-top: 8px;
                margin-bottom: 0px;
            }

            h1, h2, h3, h4, h5, h6 {
                font-family: "HelveticaNeue", Helvetica, 'MicrosoftYahei', 'HiraginoSansGB', 'WenQuanYiMicroHei', Tahoma, Arial, sans-serif;
                font-weight: 700;
                line-height: 1.1;
                color: inherit;
            }

            h3 {
                font-size: 16px;
            }

            .col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12, .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12, .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12, .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 {
                position: relative;
                min-height: 1px;
                padding-right: 0px;
                padding-left: 0px;
            }

            .control-icon {
                padding-left: 32px;
                background-position: 12px center;
            }

            #auth a:active {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
                background: transparent;
            }
    </style>

    <div class="container main padding" style="background: white; height: 810px; width: 96.5%;">
        <div class="mws-panel grid_8 manager">
            <div class="mws-tabs" style="height: 100%">
                <div class="col-md-2" style="height: 100%">
                    <div style="width: 100%; float: left">
                        <ul class="manager_ul">
                            <li><a href="#notice">发布公告</a></li>
                            <li><a href="#auth">用户列表</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-9" style="height: 100%; width: 83%;">
                    <div id="notice" class="manager_panel" style="padding-top: 0px;
                        width: 96%;
                        padding-right: 0px;">
                        <form id="subNotice" method="GET" enctype="multipart/form-data" class="form-inline" style="box-sizing: border-box !important;
                            margin-top: 10px">
                            <h3 style="margin-top: 0">发布公告</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div>
                                <div style="width: 50%; display: inline-block">
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告标题：</label>
                                        </div>
                                        <div class="form-group">
                                            <input id="title" type="text" class="form-control" name="title" placeholder="公告标题" style="width: 260px;">
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告发布时间：</label>
                                        </div>
                                        <div class="form-group">
                                            <div class='input-group date' id='datepicker1'>
                                                <input id="pubtime" name="pubtime" type='text' class="datepicker form-control" placeholder="请选择日期" style="border-radius: 3px;
                                                    width: 235px;"/>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告失效时间：</label>
                                        </div>
                                        <div class="form-group">
                                            <div class='input-group date' id='datepicker2'>
                                                <input id="failtime" name="failtime" type='text' class="datepicker form-control" placeholder="请选择日期" style="border-radius: 3px;
                                                    width: 235px;"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width: 45%;
                                    display: inline-block">
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告宽度：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="width" type="text" class="form-control" name="width" placeholder="" value="600" style="width: 100%;">
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告版面距离顶部：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="top" name="top" type='text' class="form-control" placeholder="" value="12" style="border-radius: 3px; width: 100%;"/>
                                        </div>
                                        <div class="form-group"><label>&nbsp;&nbsp;%</label>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>公告版面距离左部：</label>
                                        </div>
                                        <div class="form-group" style="width: 120px;">
                                            <input id="left" name="left" type='text' class="form-control" placeholder="" value="50" style="border-radius: 3px; width: 100%;"/>
                                        </div>
                                        <div class="form-group"><label>&nbsp;&nbsp;%</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <br>
                            <div>
                                <label>公告内容：</label>
                                <div id="editor" style="width: 100%;">
                                </div>
                                <textarea id="txdata" name="txdata" style="display: none;"></textarea>
                            </div>
                            <label>发布公告机制：公告在设定的发布时间开始生效，日期未到用户页面不会弹出。失效时间，失效日期已过，即使用户未读过也不会自动弹出该公告。</label>
                            <br>
                            <br>
                            <input type="button" value="预&nbsp;&nbsp;览" name="submit" class="btn btn-primary submit" onclick="preview()">
                            <input type="button" value="发&nbsp;&nbsp;布" name="submit" class="btn btn-primary submit" onclick="submitNotice()">
                        </form>
                    </div>
                    <div id="auth" class="manager_panel" style="width: 96%;
                        padding-right: 0px;">
                        <form>
                            <h3 style="margin-top: 0">用户列表</h3>
                            <hr style="margin-top: 0; margin-bottom: 30px;">
                            <div class="container" style="width: 98%; margin: unset; max-width: unset; background: white">
                                    <!--data-toolbar：设置装按钮的容器为id为toolbar的。-->
                                <div id="toolbar">&nbsp;搜索：</div>
                                <table class="display table table-bordered" style="width: 99.9%" id="table" data-pagination="true" data-search="true"
                                data-toolbar="#toolbar" data-page-list="[10,25,50,100,all]" data-search-align="left" data-multiple-search="true">
                                </table>
                            </div>
                            <div style="margin: 20px 0 0px 20px; float: left;">
                                <label style="color: #979797;">注意：权限修改完，被修改权限的用户需要重新登陆才能生效</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>


            $(document).ready(function () {
                formValidation();

                $('#pubtime').datepicker({
                    todayBtn: "linked",
                    language: "zh-CN",
                    orientation: "bottom auto"
                }).on("changeDate", function (e) {
                    $("#subNotice").formValidation("revalidateField", "pubtime");
                    $("#subNotice").formValidation("revalidateField", "failtime");
                });
                $('#failtime').datepicker({
                    todayBtn: "linked",
                    language: "zh-CN",
                    orientation: "bottom auto"
                }).on("changeDate", function (e) {
                    $("#subNotice").formValidation("revalidateField", "failtime");
                    $("#subNotice").formValidation("revalidateField", "pubtime");
                });
                loading();
            });

            function loading() {
                $('#table').bootstrapTable({
                    method: 'post',
                    url: "/CloudPlatform/User/getAllUsers",
                    sidePagination: "server",
                    pageNumber: 1,
                    pagination: true,
                    pageList: [10, 25, 50, 100],
                    contentType: "application/x-www-form-urlencoded",
                    clickToSelect: true,//点击行选中
                    columns: [{
                        title: '用户id',
                        field: 'id',
                        sortable: 'true'
                    }, {
                        title: '用户名',
                        field: 'name',
                        sortable: 'true'
                    }, {
                        title: '手机号',
                        field: 'phone',
                        sortable: 'true'
                    }, {
                        title: '邮箱',
                        field: 'email',
                        sortable: 'true'
                    }, {
                        title: '公司/机构/学校',
                        field: 'company',
                        sortable: 'true'
                    }, {
                        title: 'ip地址',
                        field: 'ip',
                        sortable: 'true'
                    }, {
                        title: '权限',
                        field: 'authority',
                    }]
                });
            }

            var E = window.wangEditor;
            var editor = new E('#editor');
            //自定义菜单配置
            editor.customConfig.menus = [
                'head',//标题
                'bold',//粗体
                'fontName',//字体
                'italic',//斜体
                'underline',//下划线
                'strikeThrough',//删除线
                'foreColor',//文字颜色
                'backColor',//背景颜色
                'link',//插入链接
                'list',//列表
                'justify',//对齐方式
                'quote',//引用
                'emoticon',//表情
                'image',//插入图片
                'table',//表格
                'code',//插入代码
                'undo',//撤销
                'redo'//重复
            ];
            editor.customConfig.colors = [
                '#ffffff', '#000000', '#330000',
                '#cccc99', '#cccc00', '#cc9900', '#996600', '#660000',
                '#ffff99', '#ffcc00', '#ff9900', '#ff0000', '#ff000f',
                '#ffccff', '#ff99cc', '#ff00cc', '#cc0099',
                '#ccccff', '#cc99ff', '#996699', '#cc00ff', '#660099',
                '#ccffff', '#99ccff', '#3399ff', '#6600ff', '#330099',
                '#ccff00', '#ccff99', '#99cc99', '#339999', '#339900'
            ];
            editor.customConfig.uploadImgShowBase64 = true;
            editor.create();

            //tab
            $(".mws-tabs").tabs();

            function changeAuth(uid, autho) {
                if (confirm("确认修改权限吗？")) {
                    $.ajax({
                        url: "/CloudPlatform/User/updateAutho?uid=" + uid + "&authority=" + autho,
                        type: "post",
                        success: function (data) {
                            if (data.valid === "false") {
                                swal({
                                    title: "错误",
                                    text: "权限修改失败！" + data.message,
                                    type: "error",
                                    confirmButtonText: "确认"
                                });
                            } else {
                                $('#table').bootstrapTable('destroy');
                                loading();
                                swal({
                                    title: "修改成功",
                                    text: "权限修改成功！",
                                    type: "success",
                                    confirmButtonText: "确认"
                                });

                            }
                        }
                    });
                }
            }

            function submitNotice() {
                var form = $("#subNotice");
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    if (editor.txt.text() === "") {
                        swal({
                            title: "公告内容不能为空",
                            text: "公告内容不能为空!",
                            type: "warning",
                            confirmButtonText: "确认"
                        });
                    } else {
                        if (confirm("是否确认发布？")) {
                            $("#txdata").val(editor.txt.html());
                            var element = "<div id='content'><span id='info'>公告发布中...</span>&nbsp;<img class='runningImage' src='/assets/images/loader-twitter.gif' style='width:30px;height:20px;float:right;padding-right:11px;padding-top:2px;'></div>";
                            var index = layer.alert(element, {
                                skin: 'layui-layer-lan',
                                closeBtn: 0,
                                title: "提醒",
                                btn: []
                            });
                            setTimeout(function () {
                                layer.close(index);
                                var form1 = new FormData($("#subNotice")[0]);
                                $.ajax({
                                    url: "/CloudPlatform/Utils/insertNote",
                                    type: "post",
                                    processData: false,
                                    contentType: false,
                                    data: form1,
                                    success: function (data) {
                                        swal({
                                            title: "发布成功",
                                            text: "发布成功！",
                                            type: "success",
                                            confirmButtonText: "确认"
                                        });
                                    }
                                });
                            }, 2000);
                        }
                    }
                }
            }

            function preview() {
                $("#noteHead").text($("#title").val());
                $("#notePubtime").text($("#pubtime").val());
                $("#noteContent").html("");
                $("#noteContent").append(editor.txt.html());
                $("#latestNotice").css("width", $("#width").val());
                $("#latestNotice").css("top", $("#top").val() + "%");
                $("#latestNotice").css("left", $("#left").val() + "%");
                $("#liNotice").click();
            }

            function formValidation() {
                $('#subNotice').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphiconglyphicon-ok',
                        invalid: 'glyphiconglyphicon-remove',
                        validating: 'glyphiconglyphicon-refresh'
                    },
                    fields: {
                        title: {
                            validators: {
                                notEmpty: {
                                    message: '公告标题不能为空!'
                                }
                            }
                        },
                        pubtime: {
                            validators: {
                                notEmpty: {
                                    message: '发布时间不能为空!'
                                },
                                callback: {
                                    message: '发布时间不得小于今天!',
                                    callback: function (value, validator, $field) {
                                        var datetime = new Date();
                                        var year = datetime.getFullYear();
                                        var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
                                        var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
                                        var now = year + "-" + month + "-" + date;
                                        return ($("#pubtime").val() >= now);
                                    }
                                }
                            }
                        },
                        failtime: {
                            validators: {
                                notEmpty: {
                                    message: '失效时间不能为空!'
                                },
                                callback: {
                                    message: '失效时间时间不得小于发布时间!',
                                    callback: function (value, validator, $field) {
                                        return ($("#failtime").val() >= $("#pubtime").val());
                                    }
                                }
                            }
                        },
                        width: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        top: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        },
                        left: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                }
                            }
                        }
                    }
                });
            }



    </script>

}