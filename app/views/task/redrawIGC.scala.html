@import models.Tables.DutysRow
@(row:DutysRow)(implicit session: Session)
@home.main("Task Preview"){
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("font-awesome-4.7.0/css/font-awesome.min.css")" media="screen" />
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("bootstrap-fileinput-master/css/fileinput.css")" media="screen" />
    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("palette/evol-colorpicker.min.css")" media="screen" />

    <link rel="stylesheet" type="text/css" href="@routes.Assets.versioned("mycss/redraw.css")" media="screen" />

    <script type="text/javascript" src="@routes.Assets.versioned("js/jquery-ui.js")"></script>
    <script src="@routes.Assets.versioned("cytoscape3.15.1/cytoscape.min.js")"></script>
    <script src="@routes.Assets.versioned("layer-v3.0/layer/layer.js")" type="text/javascript"></script>
    <script type="text/javascript" src="@routes.Assets.versioned("palette/evol-colorpicker.min.js")"></script>

    <style>
            .form-group-p {
                display: inline-block;
                width: 100%;
                margin-bottom: 8px!important;
            }
    </style>

    <div class="container" style="width: 98.5%;margin: unset;max-width: unset;padding: 5px">
        @task.preview(row)
        <div class="mws-panel grid_8" style="background: white!important;">
            <div class="mws-panel-body" style="border: unset">
                <div id="IGC" class="mws-panel-content" style="width: 96%;padding-top: 0;padding-right: 0;display: none">
                    <hr>
                    <ul class="nav nav-tabs" style="background: #f2f2f2;">
                        <li class="active">
                            <a href="#" data-target=".form2" data-toggle="tab">权重网络图</a>
                        </li>
                        <li class="">
                            <a href="#" data-target=".form1" data-toggle="tab">Heatmap 热图</a>
                        </li>
                    </ul>
                    <div class="tab-content" style="box-sizing: border-box!important;overflow: auto;scrollbar-color: rgba(0, 0, 0, 0.2) rgba(0, 0, 0, 0.2);scrollbar-width: thin;height: 96%;">
                        <form id="IGCNet" method="GET" enctype="multipart/form-data" class="form2 well form-inline tab-pane fade active in" style="box-sizing: border-box!important;">
                            <div class="redraw-head" style="margin-top: 10px;">
                                <h3 style="display: inline-block">重新绘图：</h3>
                                <div class="dropdown" style="display: inline-block">
                                    <button class="btn btn-dark dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false" style="padding: 7px 30px;text-shadow: unset;border-radius: 7px;">
                                        下载结果图
                                    </button>
                                    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 35px, 0px); top: 0px; left: 0px; will-change: transform;width: 150px">
                                        <a class="dropdown-item" onclick="down('jpg')">下载 jpg</a>
                                        <a class="dropdown-item" onclick="down('png')">下载 png</a>
                                        <a class="dropdown-item" onclick="downJson()">下载 json</a>
                                    </div>
                                </div>
                                <span style="margin-right: 35px; color: gray; float: right; margin-top: 30px;">提示：点击连线或结点，可查看对应的p值和c值</span>
                            </div>
                            <br>
                            <div id="cy" style="height: 600px;border:1px solid #8b8b8b9c;margin: 10px 0px 10px 0px;width: 67%;float: left;"></div>
                            <div class="redraw_panel" style="width: 26%;margin-left: 40px;display: inline-block">
                                <hr style="margin-top: 10px">
                                <h3>绘图数据筛选：</h3>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>显示小数点位数：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="dot" name="dot" class="form-control" placeholder="数字" value="3" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>p值检验阈值(0-1)：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="pthres" name="pthres" class="form-control" placeholder="数字" value="0.1" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>c值(绝对值)检验阈值(0-1)：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="cthres" name="cthres" class="form-control" placeholder="数字" value="0.5" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <hr style="margin-top: 0px">
                                <h3>矩阵文件1：</h3>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label for="">基因节点形状：</label>
                                    </div>
                                    <div class="form-group">
                                        <select name="gshape" id="gshape" style="width: 100%;">
                                            <option value="ellipse">圆形</option>
                                            <option value="triangle">三角形</option>
                                            <option value="round-triangle">圆角三角形</option>
                                            <option value="rectangle">矩形</option>
                                            <option value="round-rectangle">圆角矩形</option>
                                            <option value="bottom-round-rectangle">底部圆角矩形</option>
                                            <option value="cut-rectangle">切角矩形</option>
                                            <option value="barrel">桶形</option>
                                            <option value="rhomboid">长斜方形</option>
                                            <option value="diamond">菱形</option>
                                            <option value="round-diamond">圆角菱形</option>
                                            <option value="pentagon">五角形</option>
                                            <option value="round-pentagon">圆角五角形</option>
                                            <option value="hexagon">六边形</option>
                                            <option value="round-hexagon">圆角六边形</option>
                                            <option value="concave-hexagon">凹面六边形</option>
                                            <option value="heptagon">七边形</option>
                                            <option value="round-heptagon">圆角七边形</option>
                                            <option value="octagon">八边形</option>
                                            <option value="round-octagon">圆角八边形</option>
                                            <option value="star">星形</option>
                                            <option value="tag">标签</option>
                                            <option value="round-tag">圆角标签</option>
                                            <option value="vee">V型</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p form-group" id="borcolor">
                                    <div style="float: left">
                                        <label>基因节点颜色：</label>
                                    </div>
                                    <div style="float: left;width: 65%">
                                        <div style="float: left;width: 100%">
                                            <input id="netcolor1"  name="netcolor1" value="" class="colorPicker evo-cp0">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>基因节点透明度：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="gopa" name="gopa" class="form-control" placeholder="数字" value="1" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>基因节点大小(0-10)：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="gsize" name="gsize" class="form-control" placeholder="数字" value="5" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <div id="showgfont">
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>基因名大小(0即不显示)：</label>
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="gfont" name="gfont" class="form-control" placeholder="数字" value="12" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                        </div>
                                    </div>
                                    <div class="form-group-p  form-group">
                                        <div style="float: left">
                                            <label>基因名颜色：</label>
                                        </div>
                                        <div style="float: left;width: 70%">
                                            <div style="float: left;width: 100%">
                                                <input id="netcolor2"  name="netcolor2" value="" class="colorPicker evo-cp0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="table2" style="display: none">
                                    <hr style="margin-top: 0px;">
                                    <h3>矩阵文件2：</h3>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label for="">基因节点形状：</label>
                                        </div>
                                        <div class="form-group">
                                            <select name="eshape" id="eshape" style="width: 100%">
                                                <option value="diamond">菱形</option>
                                                <option value="ellipse">圆形</option>
                                                <option value="triangle">三角形</option>
                                                <option value="round-triangle">圆角三角形</option>
                                                <option value="rectangle">矩形</option>
                                                <option value="round-rectangle">圆角矩形</option>
                                                <option value="bottom-round-rectangle">底部圆角矩形</option>
                                                <option value="cut-rectangle">切角矩形</option>
                                                <option value="barrel">桶形</option>
                                                <option value="rhomboid">长斜方形</option>
                                                <option value="round-diamond">圆角菱形</option>
                                                <option value="pentagon">五角形</option>
                                                <option value="round-pentagon">圆角五角形</option>
                                                <option value="hexagon">六边形</option>
                                                <option value="round-hexagon">圆角六边形</option>
                                                <option value="concave-hexagon">凹面六边形</option>
                                                <option value="heptagon">七边形</option>
                                                <option value="round-heptagon">圆角七边形</option>
                                                <option value="octagon">八边形</option>
                                                <option value="round-octagon">圆角八边形</option>
                                                <option value="star">星形</option>
                                                <option value="tag">标签</option>
                                                <option value="round-tag">圆角标签</option>
                                                <option value="vee">V型</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group-p  form-group" id="borcolor">
                                        <div style="float: left">
                                            <label>基因节点颜色：</label>
                                        </div>
                                        <div style="float: left;width: 65%">
                                            <div style="float: left;width: 100%">
                                                <input id="netcolor3"  name="netcolor3" value="" class="colorPicker evo-cp0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>基因节点透明度：</label>
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="eopa" name="eopa" class="form-control" placeholder="数字" value="1" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                        </div>
                                    </div>
                                    <div class="form-group-p">
                                        <div class="form-group">
                                            <label>基因节点大小(0-10)：</label>
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="esize" name="esize" class="form-control" placeholder="数字" value="10" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                        </div>
                                    </div>
                                    <div id="showefont">
                                        <div class="form-group-p">
                                            <div class="form-group">
                                                <label>基因名大小(0即不显示)：</label>
                                            </div>
                                            <div class="form-group">
                                                <input type="text" id="efont" name="efont" class="form-control" placeholder="数字" value="12" style="width: 60px;float: left;margin-right: 5px;margin-left: 10px;">
                                            </div>
                                        </div>
                                        <div class="form-group-p form-group">
                                            <div style="float: left">
                                                <label>基因名颜色：</label>
                                            </div>
                                            <div style="float: left; width: 70%;">
                                                <div  style="float: left; width: 100%;">
                                                    <input id="netcolor4"  name="netcolor4" value="" class="colorPicker evo-cp0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr style="margin-top: 0px;">
                                <div class="form-group-p form-group" id="borcolor">
                                    <div style="float: left;">
                                        <label>连线颜色：</label>
                                    </div>
                                    <div style="float: left; width: 75%;">
                                        <div  style="float: left; width: 100%;">
                                            <input id="netcolor5"  name="netcolor5" value="" class="colorPicker evo-cp0">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>连线透明度：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="opacity" name="opacity" class="form-control" placeholder="数字" value="0.4" style="width: 65px;float: left;margin-right: 5px;margin-left: 10px;">
                                    </div>
                                </div>
                                <input type="button" value="绘&nbsp;&nbsp;制" name="submit" class="btn btn-primary btn-dark" onclick="saveNet()" style="margin-left: 30px">
                            </div>
                            <div class="update_panel" style="width: 26%;margin-left: 40px;display: inline-block">
                                <div style="padding: 20px">
                                    <h3 style="color: red">通知：</h3>
                                    <span style="color: red">软件版本已在<label class="update"></label>更新！<label class="update"></label> 前运行的 @row.sname 任务仅可下载结果文件，不支持重新绘图。</span>
                                </div>
                            </div>
                        </form>
                        <form id="IGCHeat" method="GET" enctype="multipart/form-data" class="form1 well form-inline tab-pane fade" style="box-sizing: border-box!important;">
                            <div class="redraw-head" style="margin-bottom: 30px; margin-top: 10px;">
                                <h3 style="display: inline-block">重新绘图：</h3>
                                <div class="dropdown" style="display: inline-block">
                                    <button class="btn btn-dark dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false" style="padding: 7px 30px;text-shadow: unset;border-radius: 7px;">
                                        下载结果图
                                    </button>
                                    <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 35px, 0px); top: 0px; left: 0px; will-change: transform;width: 150px">
                                        <a class="dropdown-item" id="downPic">下载 pdf</a>
                                        <a class="dropdown-item" id="downPng">下载 png</a>
                                        <a class="dropdown-item" id="downTiff">下载 tiff</a>
                                    </div>
                                </div>
                            </div>
                            <div style="width: 60%;float: left">
                                <img id="redraw_pic" src="" style="width: 100%;height: auto" >
                            </div>
                            <div class="redraw_panel redraw-right" style="width: 40%;float: left;margin-bottom: 30px;">
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>热图显示部分：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="smt" name="smt" style="width: 100px;">
                                            <option value="full">全部</option>
                                            <option value="left">左半边</option>
                                            <option value="right">右半边</option>
                                            <option value="top">上半边</option>
                                            <option value="bottom">下半边</option>
                                            <option value="topTriangle">右上三角</option>
                                            <option value="bottomTriangle ">左下三角</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否在格子上p值生成的星星矩阵：</label>
                                    </div>
                                    <div class="form-group right" style="width: 50%;">
                                        <select id="lfi" name="lfi">
                                            <option value="TRUE">yes</option>
                                            <option value="FALSE">no</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否对行聚类：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="cluster_rows" name="cluster_rows" onchange="showr()" style="width: 200px;">
                                            <option value="FALSE">不聚类</option>
                                            <option value="TRUE">自动聚类</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p" id="showautorow" style="display: none">
                                    <div class="form-group">
                                        <label>自动行聚类方法：</label>
                                    </div>
                                    <div class="form-group">
                                        <select id="crm" name="crm" style="width: 100px;">
                                            <option value="complete">complete</option>
                                            <option value="single">single</option>
                                            <option value="ward.D">ward</option>
                                            <option value="average">average</option>
                                            <option value="mcquitty">mcquitty</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p" id="showrow" style="display: none">
                                    <div class="form-group" style="margin-top: 5px;">
                                        <label for="">行聚类分割数(1-</label><label id="rnum"></label><label>)：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="rp" name="rp" class="form-control" placeholder="数字" value="1" style="width: 50px;float: left;margin-right: 5px;margin-top: 5px">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否对列聚类：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="cluster_cols" name="cluster_cols" onchange="showc()" style="width: 200px;">
                                            <option value="FALSE">不聚类</option>
                                            <option value="TRUE">自动聚类</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p" id="showautocol" style="display: none">
                                    <div class="form-group">
                                        <label>自动列聚类方法：</label>
                                    </div>
                                    <div class="form-group">
                                        <select id="ccm" name="ccm" style="width: 100px;">
                                            <option value="complete">complete</option>
                                            <option value="single">single</option>
                                            <option value="ward.D">ward</option>
                                            <option value="average">average</option>
                                            <option value="mcquitty">mcquitty</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p" id="showcol" style="display: none">
                                    <div class="form-group" style="margin-top: 5px;">
                                        <label for="">列聚类分割数(1-</label><label id="cnum"></label><label>)：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="cp" name="cp" class="form-control" placeholder="数字" value="1" style="width: 50px;float: left;margin-right: 5px;margin-top: 5px">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>归一化：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="sc" name="sc">
                                            <option value="col">column</option>
                                            <option value="row">row</option>
                                            <option value="none">none</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否取lg：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="lg" name="lg">
                                            <option value="none">none</option>
                                            <option value="lg2">lg2</option>
                                            <option value="lg10">lg10</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>颜色：<span style="font-size:small;">&nbsp;(数值从小到大)</span></label>
                                    </div>
                                    <div class="form-group" style="width: 150px;">
                                        <select name="color" id="color" onchange="show()" style="width: 100%;">
                                            <option value="#E41A1C:#FFFF00:#1E90FF">蓝-黄-红</option>
                                            <option value="#E41A1C:#FFFFFF:#1E90FF">蓝-白-红</option>
                                            <option value="0">手动输入</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="inputcolor" class="one-line" style="display: none">
                                    <div style="border: 1px solid lightgrey;border-radius: 5px;padding: 10px;margin-left: 30px">
                                        <div class="form-group-p" style="padding-left: 0">
                                            <div style="width: 100%;margin-left: 10px">
                                                <label>自定义颜色（2-6个）：</label>
                                            </div>
                                        </div>
                                        <br><br>
                                        <div class="form-group-p" >
                                            <div class="form-group" style="width: 85%">
                                                <ul id="mycolor">

                                                </ul>
                                                <input type="text" id="designcolor" name="designcolor" class="form-control" value="" style="display: none">
                                            </div>
                                        </div>
                                        <br><br>
                                        <div class="form-group-p" style="padding-left: 0">
                                            <input type="button" value="增加颜色" class="btn btn-primary btn-dark" onclick="addcolor()" style="width: 100px;">
                                            <input type="button" value="删除颜色" class="btn btn-primary btn-dark" onclick="delcolor()" style="width: 100px;">
                                        </div>
                                    </div>
                                    <br>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label for="">颜色渐变数量：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="cc" name="cc" class="form-control" placeholder="数字" value="30" style="width: 50px;float: left;margin-right: 5px;">
                                    </div>
                                </div>
                                <div class="form-group-p" id="nacolor">
                                    <div class="form-group">
                                        <label>缺失值数据颜色：</label>
                                    </div>
                                    <div class="form-group">
                                        <div style="float: left; width: 100%;">
                                            <input id="nc"  name="nc" value="" class="colorPicker evo-cp0">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否画格子边界：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select name="hasborder" style="width: 45%;" id="hasborder" onchange="bordercolor()">
                                            <option value="none">no</option>
                                            <option value="white">yes</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p" style="display:none;" id="borcolor">
                                    <div class="form-group">
                                        <label>边界颜色：</label>
                                    </div>
                                    <div class="form-group">
                                        <div style="float: left; width: 100%;">
                                            <input id="cbc"  name="cbc" value="" class="colorPicker evo-cp0">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否显示行名：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="hasrname" name="hasrname" style="width: 45%;">
                                            <option value="TRUE">yes</option>
                                            <option value="FALSE">no</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>是否显示列名：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="hascname" name="hascname" style="width: 45%;">
                                            <option value="TRUE">yes</option>
                                            <option value="FALSE">no</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>格子上显示数字：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="hasnum" name="hasnum" style="width: 45%;">
                                            <option value="FALSE">no</option>
                                            <option value="TRUE">yes</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group" style="margin-top: 5px;">
                                        <label for="">行 X 列聚类树高度：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="rtree" name="rtree" class="form-control" placeholder="数字" value="50" style="width: 50px;float: left;margin-right: 5px;margin-top: 5px">
                                        <label style="float: left;margin-top: 12px;">X</label>
                                        <input type="text" id="ctree" name="ctree" class="form-control" placeholder="数字" value="50" onblur="ylim();" style="width: 50px;  margin-left: 5px;float: left;margin-top: 5px;margin-right: 20px">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group">
                                        <label>x轴字体旋转角度：</label>
                                    </div>
                                    <div class="form-group right">
                                        <select id="xfa" name="xfa" style="width: 45%;">
                                            <option value="90">90</option>
                                            <option value="0">0</option>
                                            <option value="315">45</option>
                                            <option value="270">270</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group" style="margin-top: 5px;">
                                        <label for="">格子内字体大小：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="fn" name="fn" class="form-control" placeholder="数字" value="8" style="width: 50px;float: left;margin-right: 5px;margin-top: 5px">
                                    </div>
                                </div>
                                <div class="form-group-p">
                                    <div class="form-group" style="margin-top: 5px;">
                                        <label for="">XY 轴字体大小：</label>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="xfs" name="xfs" class="form-control" placeholder="数字" value="10" style="width: 50px;float: left;margin-right: 5px;margin-top: 5px">
                                        <label style="float: left;margin-top: 12px;">：</label>
                                        <input type="text" id="yfs" name="yfs" class="form-control" placeholder="数字" value="10" style="width: 50px;  margin-left: 5px;float: left;margin-top: 5px;margin-right: 20px">
                                    </div>
                                </div>
                                <br>
                                <br>
                                <input type="button" value="绘&nbsp;&nbsp;制" name="submit" class="btn btn-primary btn-dark" onclick="DrawHeat()" style="margin-left: 30px">
                            </div>
                            <div class="update_panel redraw-right" style="width: 40%;float: left;margin-bottom: 30px;">
                                <div style="padding: 20px">
                                    <h3 style="color: red">通知：</h3>
                                    <span style="color: red">软件版本已在<label class="update"></label>更新！<label class="update"></label> 前运行的 @row.sname 任务仅可下载结果文件，不支持重新绘图。</span>
                                </div>
                            </div>
                        </form>
                    </div>
                    <br>
                </div>
            </div>
        </div>
    </div>


@*    <script src="@routes.Assets.versioned("bootstrap-fileinput-master/js/fileinput.min.js")" type="text/javascript"></script>*@
@*    <script src="@routes.Assets.versioned("bootstrap-fileinput-master/js/locales/zh.js")" type="text/javascript"></script>*@

    <script>

            const updatetime="2020-08-04";

            function checkupdate(){
                $(".update").text(updatetime);
                if("@row.subtime".split(" ")[0]<=updatetime) {
                    $(".update_panel").show();
                    $(".redraw_panel").hide();
                } else {
                    $(".redraw_panel").show();
                    $(".update_panel").hide();
                }
            }

            const colorValidators = {
                validators: {
                    notEmpty:{
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^#([0-9a-fA-F]{6})$/,
                        message: "色值不合法！色值必须以#开头，色值需为6位"
                    }
                }
            };

            var colornum=0;
            var allcol=0;
            var allrow=0;

            function formValidation() {
                $('#IGCHeat').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        rtree: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        ctree: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        rp: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 1,
                                    message: "必须大于1！"
                                }
                            }
                        },
                        cp: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 1,
                                    message: "必须大于1！"
                                }
                            }
                        },
                        cc: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        xfs: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        yfs: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        fn: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        nc:colorValidators,
                        cbc:colorValidators
                    }
                });
                $('#IGCNet').formValidation({
                    framework: 'bootstrap',
                    icon: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        dot: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        pthres: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "必须大于等于0！"
                                },
                                lessThan: {
                                    value: 1,
                                    message: "必须小于等于1！"
                                }
                            }
                        },
                        cthres: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "必须大于等于0！"
                                },
                                lessThan: {
                                    value: 1,
                                    message: "必须小于等于1！"
                                }
                            }
                        },
                        gopa: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        gsize: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "必须大于等于0！"
                                },
                                lessThan: {
                                    value: 10,
                                    message: "必须小于等于10！"
                                }
                            }
                        },
                        gfont: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        eopa: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        esize: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                },
                                greaterThan: {
                                    value: 0,
                                    message: "必须大于等于0！"
                                },
                                lessThan: {
                                    value: 10,
                                    message: "必须小于等于10！"
                                }
                            }
                        },
                        efont: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        opacity: {
                            validators: {
                                notEmpty: {
                                    message: '不能为空!'
                                },
                                numeric: {
                                    message: '必须为数字！'
                                }
                            }
                        },
                        netcolor1:colorValidators,
                        netcolor2:colorValidators,
                        netcolor3:colorValidators,
                        netcolor4:colorValidators,
                        netcolor5:colorValidators
                    }
                });
            }

            var cy;

            $(document).ready(function () {
                if("@row.status"=="已完成"){
                    $("#IGC").show();
                    checkupdate();
                    loading();
                }
            });

            function loading() {
                $.ajax({
                    url:"/CloudPlatform/SoftTool/getIGCData?taskname=@row.taskname",
                    type:"post",
                    success:function (data) {
                        if(data.table2) $("#table2").show();
                        cy = window.cy = cytoscape({
                            container: document.getElementById('cy'),
                            layout: {
                                name: 'cose',
                                idealEdgeLength: 100,
                                nodeOverlap: 20,
                                refresh: 20,
                                fit: true,
                                padding: 30,
                                randomize: false,
                                componentSpacing: 100,
                                nodeRepulsion: 400000,
                                edgeElasticity: 100,
                                nestingFactor: 5,
                                gravity: 80,
                                numIter: 1000,
                                initialTemp: 200,
                                coolingFactor: 0.95,
                                minTemp: 1.0
                            },
                            style: data.selector,
                            elements: data.rows,
                            minZoom: 1e-1,
                            maxZoom: 5,
                            wheelSensitivity: 0.05
                        });
                        cy.unbind('click');
                        cy.bind('click', function(e){
                            if (e.target === cy)  {
                                cy.edges().removeClass('highlighted');
                            }
                            else if(e.target.group() == "nodes") {
                                if(cy.edges("[target='" + e.target.id() + "']").hasClass('highlighted')||cy.edges("[source='" + e.target.id() + "']").hasClass('highlighted')){
                                    cy.edges().removeClass('highlighted');
                                }else{
                                    cy.edges().removeClass('highlighted');
                                    cy.edges("[target='" + e.target.id() + "']").addClass('highlighted');
                                    cy.edges("[source='" + e.target.id() + "']").addClass('highlighted');
                                }
                            }else {
                                if(cy.edges("[id='" + e.target.id() + "']").hasClass('highlighted'))
                                    cy.edges("[id='" + e.target.id() + "']").removeClass('highlighted');
                                else cy.edges("[id='" + e.target.id() + "']").addClass('highlighted');
                            }
                        });
                        $.each(data.elements2,function (i,v) {
                            if(i.indexOf("color")>=0)
                                $("#"+i).colorpicker({color: v, defaultPalette: 'web',showOn:"button"})
                                        .on("change.color", function(event, color){ //选择颜色事件
                                            //formValidation重新验证颜色
                                            $("#IGCNet").formValidation("revalidateField", i);
                                        });
                            else $("#"+i).val(v);
                        });
                        $(".evo-cp-wrap").css("width", "120px");
                        $(".evo-cp-wrap").css("float", "left");


                        $("#redraw_pic").attr("src","/CloudPlatform/pic?path="+data.pics[0]+"&num="+Math.random());
                        $("#downPic").attr("href","/CloudPlatform/SoftTool/download?path="+data.downpics);
                        $("#downPng").attr("href","/CloudPlatform/SoftTool/download?path="+data.downpng);
                        $("#downTiff").attr("href","/CloudPlatform/SoftTool/download?path="+data.downtiffs);
                        $("#rnum").text(data.rnum);
                        $("#cnum").text(data.cnum);
                        allcol=data.allcol;
                        allrow=data.allrow;
                        $.each(data.elements1,function (i,v) {
                            if(i=="color") {
                                if(colorpattern(v)) $("#"+i).val(v);
                                else {
                                    $("#"+i).val("0");
                                    $("#inputcolor").show();
                                }
                                splitcolor(v);
                            } else if(i=="nc" || i=="cbc") {
                                $("#"+i).colorpicker({color: v, defaultPalette: 'web', showOn:"button"})
                                        .on("change.color",function (event,color){
                                            $("#IGCHeat").formValidation("revalidateField",i);
                                        });
                            } else $("#"+i).val(v);
                        });
                        bordercolor();
                        showr();
                        showc();
                        $("#borcolor .evo-cp-wrap").css("float", "left");
                        $("#borcolor .evo-cp-wrap").css("width", "120px");
                        $("#nacolor .evo-cp-wrap").css("float", "left");
                        $("#nacolor .evo-cp-wrap").css("width", "120px");

                        checkupdate();
                    }
                });
            }

            function down(param) {
                var pic="";
                if(param=="jpg") pic=cy.jpg();
                else pic=cy.png({"bg":"#fff"});
                var a = document.createElement('a');          // 创建一个a节点插入的document
                var event = new MouseEvent('click');          // 模拟鼠标click点击事件
                a.download = 'netPic';                 // 设置a节点的download属性值
                a.href = pic;                                 // 将图片的src赋值给a节点的href
                a.dispatchEvent(event);
            }

            function downJson() {
                var ele = document.createElement('a');
                ele.download = "test.json";
                var blob = new Blob([JSON.stringify(cy.json(), null, 2)],{type:'application/json,charset=utf-8;'});
                var blob = new Blob([JSON.stringify(cy.json())]);
                ele.href = URL.createObjectURL(blob);
                document.body.appendChild(ele);
                ele.click();
                document.body.removeChild(ele);
                console.log(JSON.stringify(cy.json()));
            }



            function saveNet() {
                var form = $("#IGCNet");
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    var element = "<div id='content'><span id='info'>绘图中，请耐心等待...</span>&nbsp;<img class='runningImage' src='/assets/images/loader-twitter.gif' style='width: 30px;height: 20px;float: right;padding-right: 11px;padding-top: 2px;'></div>"
                    var index = layer.alert(element, {
                        skin: 'layui-layer-lan',
                        closeBtn: 0,
                        title: "提醒",
                        btn: []
                    });
                    var form1 = new FormData($("#IGCNet")[0]);
                    $.ajax({
                        url: "/CloudPlatform/SoftTool/redrawIGCNet?taskname=@row.taskname",
                        type: "post",
                        processData: false,
                        contentType: false,
                        data: form1,
                        success: function (data) {
                            loading();
                            layer.close(index);
                        }
                    });
                }
            }






            function splitcolor(param) {
                var colo="";
                var colors=param.toString().split(":");
                colornum=colors.length;
                $.each(colors,function (i,v) {
                    colo +="<li id='li_color"+i+"' class='form-group' style='width: 100%'><div style=' width: 100%;float: left;'><input id='color"+i+"'  name='color"+i+"' class='colorPicker evo-cp0'></div></li>";
                });
                $("#mycolor").html(colo);
                $.each(colors,function (i,v) {
                    $("#IGCHeat").formValidation('addField','color'+i, colorValidators);
                    $("#color"+i).colorpicker({color: v, defaultPalette: 'web', showOn: "button"})
                            .on("change.color",function (event,color){
                                $("#IGCHeat").formValidation("revalidateField",'color'+i);
                            });
                });
                $("#inputcolor .evo-cp-wrap").css("float", "left");
                $("#inputcolor .evo-cp-wrap").css("width", "200px");
            }

            function colorpattern(param) {
                var count = $('#color').find('option').length;
                for(var i=0;i<count;i++)
                {
                    if($('#color').get(0).options[i].value == param) return true;
                }
                return false;
            }

            function show() {
                var param = $("#color").val();
                if(param=="0") $("#inputcolor").show();
                else $("#inputcolor").hide();

            }

            function addcolor() {
                if(colornum==6){
                    swal({
                        title: "添加颜色失败",
                        text: "添加失败，颜色最大数量为6个！",
                        type: "warning",
                        confirmButtonText: "确认"
                    });
                }else{
                    var coloid='color'+colornum;
                    var colo = "<li id='li_color"+colornum+"' class='form-group' style='width: 100%'><div style=' width: 100%;float: left;'><input id='"+coloid+"'  name='"+coloid+"' class='colorPicker evo-cp0'></div></li>";
                    $("#mycolor").append(colo);
                    $("#IGCHeat").formValidation('addField',coloid, colorValidators);
                    $("#"+coloid).colorpicker({color: '#E41A1C', defaultPalette: 'web', showOn:"button"});
                    $("#"+coloid).on("change.color",function (event,color){
                        $("#IGCHeat").formValidation("revalidateField",coloid);
                    });
                    $("#inputcolor .evo-cp-wrap").css("float", "left");
                    $("#inputcolor .evo-cp-wrap").css("width", "200px");
                    colornum=colornum+1;
                    console.log(colornum);
                }

            }

            function delcolor() {
                if(colornum==2){
                    swal({
                        title: "删除颜色失败",
                        text: "删除失败，颜色最小数量为2个！",
                        type: "warning",
                        confirmButtonText: "确认"
                    });
                }else{
                    $("#li_color"+(colornum-1)).remove();
                    colornum=colornum-1;
                    $("#IGCHeat").formValidation('removeField','color'+(colornum-1));
                }
                console.log(colornum);
            }

            function DrawHeat() {
                var form = $("#IGCHeat");
                var fv = form.data("formValidation");
                fv.validate();
                if (fv.isValid()) {
                    if(checkrpcp()){
                        var element = "<div id='content'><span id='info'>绘图中，请耐心等待...</span>&nbsp;<img class='runningImage' src='/assets/images/loader-twitter.gif' style='width: 30px;height: 20px;float: right;padding-right: 11px;padding-top: 2px;'></div>"
                        var index = layer.alert(element, {
                            skin: 'layui-layer-lan',
                            closeBtn: 0,
                            title: "提醒",
                            btn: []
                        });
                        var colors=[];
                        for(var i=0;i<colornum;i++)
                            colors.push($("#color"+i).val());
                        $("#designcolor").val(colors.join(":"));
                        var form1 = new FormData($("#IGCHeat")[0]);
                        $.ajax({
                            url: "/CloudPlatform/SoftTool/redrawIGCHeat?rtree="+$("#rtree").val()+"&ctree="+$("#ctree").val()+"&xfs="+$("#xfs").val()+"&yfs="+$("#yfs").val()+"&sc="+$("#sc").val()+"&xfa="+$("#xfa").val()+"&fn="+$("#fn").val()+"&taskname=@row.taskname",
                            type: "post",
                            processData: false,
                            contentType: false,
                            data: form1,
                            success: function (data) {
                                layer.close(index);
                                if(data.valid=="false"){
                                    swal({
                                        title: "错误",
                                        text: data.message,
                                        type: "error",
                                        confirmButtonText: "确认"
                                    });
                                }else{
                                    $("#redraw_pic").attr("src","/CloudPlatform/pic?path="+data.pics+"&num="+Math.random());
                                    $("#cnum").text(data.cnum);
                                    $("#rnum").text(data.rnum);
                                }
                            }
                        });
                    }
                }
            }

            function checkrpcp() {
                if(parseInt($("#rp").val())>allrow) {
                    swal({
                        title: "行聚类分割数错误",
                        text: "行聚类分割数超过总行数！",
                        type: "warning",
                        confirmButtonText: "确认"
                    });
                    return false;
                }
                if(parseInt($("#cp").val())>allcol) {
                    swal({
                        title: "列聚类分割数错误",
                        text: "列聚类分割数超过总列数！",
                        type: "warning",
                        confirmButtonText: "确认"
                    });
                    return false;
                }
                return true;
            }

            function bordercolor() {
                var colorparam = $("#hasborder").val();
                if (colorparam == "white") $("#borcolor").show();
                else $("#borcolor").hide();
            }

            function showr() {
                var colorparam = $("#cluster_rows").val();
                if (colorparam != "FALSE") {
                    if(colorparam=="TRUE") $("#showautorow").show();
                    else $("#showautorow").hide();
                    $("#showrow").show();
                } else {
                    $("#showautorow").hide();
                    $("#showrow").hide();
                }
            }

            function showc() {
                var colorparam = $("#cluster_cols").val();
                if (colorparam != "FALSE") {
                    if(colorparam=="TRUE") $("#showautocol").show();
                    else $("#showautocol").hide();
                    $("#showcol").show();
                } else {
                    $("#showcol").hide();
                    $("#showautocol").hide();
                }
            }


    </script>

}